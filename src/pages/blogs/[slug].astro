---
export const prerender = false;

import Wrapper from "@/layouts/Wrapper.astro";
import HeaderOne from "@/layouts/headers/HeaderOne";
import FooterFour from "@/layouts/footers/FooterFour";
import fetchApi from "@/lib/strapi";
import type { BlogResponse } from "@/@types/blog";
import BlogDetailsArea from "@/components/single-blog/BlogDetailsArea";

export async function GET(slug: string) {
  return await fetchApi<BlogResponse>({
    endpoint: `blogs?populate[image][fields][0]=name&populate[image][fields][1]=alternativeText&populate[image][fields][2]=caption&populate[image][fields][3]=url&filters[slug]=${slug}`,
  });
}

const data = await GET(Astro.params.slug || "");

if (data.data && data?.data?.length < 1) {
  return new Response(null, {
    status: 404,
    statusText: "Not found",
  });
}
---

<Wrapper title="Blogs">
  <HeaderOne />
  <BlogDetailsArea blog={data.data[0]!} />
  <FooterFour />
</Wrapper>
